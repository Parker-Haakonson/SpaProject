@page "/bookings"
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using SpaProject.Models
@using SpaProject.Data
@implements IAsyncDisposable
@inject IDbContextFactory<SpaProject.Data.SpaProjectServiceDB> DbFactory

<QuickGrid Class="table" Items="FilteredBookings">
    <PropertyColumn Property="email => LogedIn.GetEmail()" Title="Email" />
    <PropertyColumn Property="service => service.Name" />
    <PropertyColumn Property="service => service.Price" />
    <PropertyColumn Property="service => service.assignedStaff" Title="Assigned Staff" />
    <PropertyColumn Property="service => service.month" />
    <PropertyColumn Property="service => service.year" />
    <PropertyColumn Property="service => service.day" />
    <PropertyColumn Property="service => service.time" />
</QuickGrid>

@code{
    private SpaProjectServiceDB context = default!;

    [SupplyParameterFromQuery]
    private string? TitleFilter { get; set; }

    private IQueryable<Service> FilteredBookings =>
        context.Service.Where(m => m.CustomerId.Equals(LogedIn.GetId()));

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();
    }

    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}
